---
title: 我如何写React代码之原始人
date: 2020-01-03 19:44:24
tags:
  - React
  - JavaScript
  - 前端
  - 我如何写React代码
---



### 前言

因为前一段时间的一些经历，让我想了很多。现在敲代码都是要多加一道工序，不仅仅满足于：我用这个API可以实现这个功能，而是要问自己：我为什么要用这个API或这种方式去实现这个功能？带着问题写业务的这段时间，感触比较多，所以想在此记录下。



### 有新需求了

下图是一个很常见的PC布局：

![图片](/images/2020-01-03_20-05-40.png)

React的核心思想就是组件化，开发时可以将功能或UI划分成不同的小型组件，然后再组合在一起完成完整的业务功能。每个小组件都只负责某一块功能的实现和交互，这对于多人协作（任务分配），以及后期维护（每个组件的功能单一）都是非常具有优势的。

看到（第一眼）视觉稿的我，在心里已经将其大卸八块，正如上图所标示的那样，某某组件、某某组件...Perfect !

### 终于要码代码了，Go

接着就要开始专注于其中的一个’某某组件’了。这时主要关注的就以下这些问题了：

1. 这个组件需要哪些state，又需要哪些props？
2. 生命周期有必要使用吗？（业务需要）
3. 我要用React.Compoent还是React.PureComponent?
4. 我要用function还是class？
5. UI展示/CSS相关（忽略）
6. 基本元素使用/HTML相关（忽略）

### 该组合这些小玩意了

上知需求文档，下晓交互视觉，很快将剩下的小零件都设计并开发完了。接着就需要一些容器组件如Layout之类的来组合这些小零件了。这时你就会发现，在一个非常底层的某个小零件需要的props却要在或许是最顶层的容器组件中作为state来管理，如下图：

![图片](/images/2020-01-03_20-44-57.png)

因为props要必须要一层一层的传递下来，所以或许会破坏中间某些容器组件或其他高级组件（组合组件）的设计合理性，因为要强行增加一个或许不需要的props。

一两个这种情况或许还能忍受，但如果传递的props比较多的话，会特别麻烦，所以有些人就干脆不零件化了，干脆整个页面/或某一个功能就是一个单独的组件，没有props。这个组件管理着所有的state（我见过有很多人就是这样写代码的，常常一份文件就有4、500行代码），这其实会造成一个更大的问题，随着业务的更新迭代，代码会变得越来越难维护。

这其实就相当于是一种的逃避的行为，因为我们的问题是props如何传递，而不是不需要更细更小的组件，我们需要它，因为它很完美（功能单一，props传递和小组件本身没有关系）。

### 我该怎么办

在没有context、没有redux的世界，我选择的是props传递的痛苦，因为我根本无法忍受所有混杂的state放在一起，无论是命名冲突还是查找使用，都会带来极大的不便。或许你可以通过事件机制，像addEventListener()那样，在需要管理state的容器组件里添加事件，然后在小零件里触发事件去更新state，这样可以减少props更新(方法)的传递，也或许可以以同样的方式将小零件的state和容器组件的state做同步，这样就直接不用传递props。这种事件的机制，其实已经和Redux的Connect很像了，只是state的存储位置以及更新方式不同。

### 进击的原始人

下一篇：[我如何写React代码之Context]()



